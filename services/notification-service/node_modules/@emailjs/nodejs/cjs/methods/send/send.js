"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.send = void 0;
const store_1 = require("../../store/store");
const sendPost_1 = require("../../api/sendPost");
const validateParams_1 = require("../../utils/validateParams/validateParams");
const validateTemplateParams_1 = require("../../utils/validateTemplateParams/validateTemplateParams");
const isBlockedValueInParams_1 = require("../../utils/isBlockedValueInParams/isBlockedValueInParams");
const blockedEmailError_1 = require("../../errors/blockedEmailError/blockedEmailError");
const isLimitRateHit_1 = require("../../utils/isLimitRateHit/isLimitRateHit");
const limitRateError_1 = require("../../errors/limitRateError/limitRateError");
/**
 * Send a template to the specific EmailJS service
 * @param {string} serviceID - the EmailJS service ID
 * @param {string} templateID - the EmailJS template ID
 * @param {object} templateParams - the template params, what will be set to the EmailJS template
 * @param {object} options - the EmailJS SDK config options
 * @returns {Promise<EmailJSResponseStatus>}
 */
const send = async (serviceID, templateID, templateParams, options) => {
    const publicKey = (options === null || options === void 0 ? void 0 : options.publicKey) || store_1.store.publicKey;
    const privateKey = (options === null || options === void 0 ? void 0 : options.privateKey) || store_1.store.privateKey;
    const storageProvider = (options === null || options === void 0 ? void 0 : options.storageProvider) || store_1.store.storageProvider;
    const blockList = { ...store_1.store.blockList, ...options === null || options === void 0 ? void 0 : options.blockList };
    const limitRate = { ...store_1.store.limitRate, ...options === null || options === void 0 ? void 0 : options.limitRate };
    (0, validateParams_1.validateParams)(publicKey, serviceID, templateID);
    (0, validateTemplateParams_1.validateTemplateParams)(templateParams);
    if (templateParams && (0, isBlockedValueInParams_1.isBlockedValueInParams)(blockList, templateParams)) {
        return Promise.reject((0, blockedEmailError_1.blockedEmailError)());
    }
    if (await (0, isLimitRateHit_1.isLimitRateHit)(limitRate, storageProvider)) {
        return Promise.reject((0, limitRateError_1.limitRateError)());
    }
    const params = {
        lib_version: '4.0.4',
        user_id: publicKey,
        accessToken: privateKey,
        service_id: serviceID,
        template_id: templateID,
        template_params: templateParams,
    };
    return (0, sendPost_1.sendPost)(JSON.stringify(params));
};
exports.send = send;
